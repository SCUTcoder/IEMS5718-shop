<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á´†Á®ã's Shop - Home (Dynamic)</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <h1>Welcome to Á´†Á®ã's Shop</h1>
        <nav>
            <ul>
                <li><a href="index-dynamic.html">Home</a></li>
                <li><a href="product.html">Products</a></li>
            </ul>
        </nav>
        <nav class="breadcrumb">
            <span>Home</span>
        </nav>
        <div class="cart-container">
            <div class="cart-icon">
                üõí <span class="cart-count">0</span>
            </div>
            <div class="cart-dropdown">
                <h3>Shopping Cart</h3>
                <div class="cart-items">
                    <p class="empty-cart">Your cart is empty</p>
                </div>
                <button class="btn checkout-btn" disabled>Checkout</button>
            </div>
        </div>
    </header>

    <main>
        <section class="hero">
            <h2>Your One-Stop Shop for Everything</h2>
            <p>Discover amazing products at great prices!</p>
            <a href="#products" class="btn">Shop Now</a>
        </section>

        <section id="products" class="products">
            <h2>Featured Products</h2>
            <div id="api-status" class="api-status"></div>
            <div class="product-grid" id="product-grid">
                <!-- Products will be loaded dynamically from backend -->
                <p class="loading">Loading products...</p>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 IEMS5718 Shop. All rights reserved.</p>
    </footer>

    <script>
        // Âä®ÊÄÅËé∑ÂèñAPIÂú∞ÂùÄÔºöÂºÄÂèëÁéØÂ¢ÉÁî®8080ÔºåÁîü‰∫ßÁéØÂ¢ÉÁî®ÂΩìÂâçÂüüÂêç/api
        const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
            ? 'http://localhost:8080/api' 
            : window.location.origin + '/api';
        
        console.log('API Base URL:', API_BASE_URL);
        
        // Cart functionality
        let cart = JSON.parse(localStorage.getItem('iems5718-cart')) || [];
        let productsData = {};

        // Load products from backend
        async function loadProducts() {
            const productGrid = document.getElementById('product-grid');
            const apiStatus = document.getElementById('api-status');
            
            try {
                const response = await fetch(`${API_BASE_URL}/products`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const products = await response.json();
                
                // Show success message
                apiStatus.innerHTML = '<p class="success">‚úÖ Connected to backend API</p>';
                apiStatus.style.padding = '10px';
                apiStatus.style.backgroundColor = '#d4edda';
                apiStatus.style.border = '1px solid #c3e6cb';
                apiStatus.style.borderRadius = '5px';
                apiStatus.style.marginBottom = '20px';
                
                // Clear loading message
                productGrid.innerHTML = '';
                
                // Store products data
                products.forEach(product => {
                    productsData[product.id] = product;
                });
                
                // Render products
                products.forEach(product => {
                    const productCard = createProductCard(product);
                    productGrid.appendChild(productCard);
                });
                
                // Initialize cart buttons
                initializeCartButtons();
                
            } catch (error) {
                console.error('Error loading products:', error);
                apiStatus.innerHTML = '<p class="error">‚ö†Ô∏è  Backend API not available. Showing demo data.</p>';
                apiStatus.style.padding = '10px';
                apiStatus.style.backgroundColor = '#f8d7da';
                apiStatus.style.border = '1px solid #f5c6cb';
                apiStatus.style.borderRadius = '5px';
                apiStatus.style.marginBottom = '20px';
                
                // Load fallback products
                loadFallbackProducts();
            }
        }

        // Create product card HTML
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            
            card.innerHTML = `
                <a href="product.html?id=${product.id}">
                    <img src="${product.imageUrl}" alt="${product.name}" class="product-image">
                </a>
                <h3><a href="product.html?id=${product.id}">${product.name}</a></h3>
                <p>${product.description}</p>
                <span class="price">$${product.price.toFixed(2)}</span>
                <button class="btn add-to-cart" data-product-id="${product.id}">Add to Cart</button>
            `;
            
            return card;
        }

        // Load fallback products if backend is unavailable
        function loadFallbackProducts() {
            const productGrid = document.getElementById('product-grid');
            productGrid.innerHTML = '';
            
            const fallbackProducts = [
                { id: 1, name: 'Gaming Laptop', description: 'High-performance gaming laptop with latest specs', price: 1299.99, imageUrl: 'images/product1.jpg' },
                { id: 2, name: 'Wireless Headphones', description: 'Premium wireless headphones with noise cancellation', price: 249.99, imageUrl: 'images/product2.jpg' },
                { id: 3, name: 'Smart Watch', description: 'Latest smartwatch with health monitoring features', price: 399.99, imageUrl: 'images/product3.jpg' },
                { id: 4, name: 'Tablet PC', description: 'Portable tablet perfect for work and entertainment', price: 599.99, imageUrl: 'images/product4.jpg' }
            ];
            
            fallbackProducts.forEach(product => {
                productsData[product.id] = product;
                const card = createProductCard(product);
                productGrid.appendChild(card);
            });
            
            initializeCartButtons();
        }

        // Initialize add to cart buttons
        function initializeCartButtons() {
            document.querySelectorAll('.add-to-cart').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-product-id'));
                    addToCart(productId);
                });
            });
        }

        // Add to cart function
        function addToCart(productId) {
            const product = productsData[productId];
            if (!product) return;
            
            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: productId,
                    name: product.name,
                    price: product.price,
                    image: product.imageUrl,
                    quantity: 1
                });
            }
            
            localStorage.setItem('iems5718-cart', JSON.stringify(cart));
            updateCartDisplay();
            showNotification(`${product.name} added to cart!`);
        }

        // Update cart display
        function updateCartDisplay() {
            const cartCount = document.querySelector('.cart-count');
            const cartItems = document.querySelector('.cart-items');
            const checkoutBtn = document.querySelector('.checkout-btn');
            
            if (!cartCount || !cartItems || !checkoutBtn) return;
            
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p class="empty-cart">Your cart is empty</p>';
                checkoutBtn.disabled = true;
            } else {
                cartItems.innerHTML = cart.map(item => `
                    <div class="cart-item">
                        <img src="${item.image}" alt="${item.name}">
                        <div class="cart-item-details">
                            <h4>${item.name}</h4>
                            <span class="cart-item-price">$${item.price}</span>
                            <input type="number" class="cart-item-quantity" value="${item.quantity}"
                                   min="1" data-product-id="${item.id}">
                        </div>
                        <button class="cart-item-remove" data-product-id="${item.id}">√ó</button>
                    </div>
                `).join('');
                
                checkoutBtn.disabled = false;
                
                document.querySelectorAll('.cart-item-quantity').forEach(input => {
                    input.addEventListener('change', function() {
                        updateCartQuantity(parseInt(this.getAttribute('data-product-id')), this.value);
                    });
                });
                
                document.querySelectorAll('.cart-item-remove').forEach(button => {
                    button.addEventListener('click', function() {
                        removeFromCart(parseInt(this.getAttribute('data-product-id')));
                    });
                });
            }
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            localStorage.setItem('iems5718-cart', JSON.stringify(cart));
            updateCartDisplay();
        }

        function updateCartQuantity(productId, newQuantity) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity = parseInt(newQuantity);
                if (item.quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    localStorage.setItem('iems5718-cart', JSON.stringify(cart));
                    updateCartDisplay();
                }
            }
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification slide-in';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('slide-in');
                notification.classList.add('slide-out');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Mobile cart toggle
        const cartIcon = document.querySelector('.cart-icon');
        if (cartIcon) {
            cartIcon.addEventListener('click', function(e) {
                if (window.innerWidth <= 768) {
                    e.preventDefault();
                    const cartContainer = this.parentElement;
                    cartContainer.classList.toggle('active');
                }
            });
        }

        // Checkout button
        const checkoutBtn = document.querySelector('.checkout-btn');
        if (checkoutBtn) {
            checkoutBtn.addEventListener('click', function() {
                alert('Checkout functionality will be implemented in Phase 2!');
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadProducts();
            updateCartDisplay();
        });
    </script>
</body>
</html>
